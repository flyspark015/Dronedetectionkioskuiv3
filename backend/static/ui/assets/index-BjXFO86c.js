var w=Uint8Array,P=Uint16Array,Be=Int32Array,ve=new w([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),me=new w([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Fe=new w([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ye=function(r,e){for(var t=new P(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Be(t[30]),n=1;n<30;++n)for(var a=t[n];a<t[n+1];++a)i[a]=a-t[n]<<5|n;return{b:t,r:i}},pe=ye(ve,2),we=pe.b,Ke=pe.r;we[28]=258,Ke[258]=28;var We=ye(me,0),Ve=We.b,q=new P(32768);for(var g=0;g<32768;++g){var M=(g&43690)>>1|(g&21845)<<1;M=(M&52428)>>2|(M&13107)<<2,M=(M&61680)>>4|(M&3855)<<4,q[g]=((M&65280)>>8|(M&255)<<8)>>1}var O=(function(r,e,t){for(var n=r.length,i=0,a=new P(e);i<n;++i)r[i]&&++a[r[i]-1];var o=new P(e);for(i=1;i<e;++i)o[i]=o[i-1]+a[i-1]<<1;var s;if(t){s=new P(1<<e);var u=15-e;for(i=0;i<n;++i)if(r[i])for(var h=i<<4|r[i],f=e-r[i],l=o[r[i]-1]++<<f,c=l|(1<<f)-1;l<=c;++l)s[q[l]>>u]=h}else for(s=new P(n),i=0;i<n;++i)r[i]&&(s[i]=q[o[r[i]-1]++]>>15-r[i]);return s}),S=new w(288);for(var g=0;g<144;++g)S[g]=8;for(var g=144;g<256;++g)S[g]=9;for(var g=256;g<280;++g)S[g]=7;for(var g=280;g<288;++g)S[g]=8;var xe=new w(32);for(var g=0;g<32;++g)xe[g]=5;var je=O(S,9,1),_e=O(xe,5,1),J=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},T=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},G=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Ne=function(r){return(r+7)/8|0},Je=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new w(r.subarray(e,t))},Ge=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],p=function(r,e,t){var n=new Error(e||Ge[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,p),!t)throw n;return n},X=function(r,e,t,n){var i=r.length,a=0;if(!i||e.f&&!e.l)return t||new w(0);var o=!t,s=o||e.i!=2,u=e.i;o&&(t=new w(i*3));var h=function(ue){var fe=t.length;if(ue>fe){var de=new w(Math.max(fe*2,ue));de.set(t),t=de}},f=e.f||0,l=e.p||0,c=e.b||0,y=e.l,C=e.d,v=e.m,A=e.n,k=i*8;do{if(!y){f=T(r,l,1);var B=T(r,l+1,3);if(l+=3,B)if(B==1)y=je,C=_e,v=9,A=5;else if(B==2){var W=T(r,l,31)+257,ne=T(r,l+10,15)+4,ie=W+T(r,l+5,31)+1;l+=14;for(var Z=new w(ie),V=new w(19),x=0;x<ne;++x)V[Fe[x]]=T(r,l+x*3,7);l+=ne*3;for(var ae=J(V),Oe=(1<<ae)-1,Se=O(V,ae,1),x=0;x<ie;){var oe=Se[T(r,l,Oe)];l+=oe&15;var E=oe>>4;if(E<16)Z[x++]=E;else{var z=0,R=0;for(E==16?(R=3+T(r,l,3),l+=2,z=Z[x-1]):E==17?(R=3+T(r,l,7),l+=3):E==18&&(R=11+T(r,l,127),l+=7);R--;)Z[x++]=z}}var se=Z.subarray(0,W),U=Z.subarray(W);v=J(se),A=J(U),y=O(se,v,1),C=O(U,A,1)}else p(1);else{var E=Ne(l)+4,F=r[E-4]|r[E-3]<<8,K=E+F;if(K>i){u&&p(0);break}s&&h(c+F),t.set(r.subarray(E,K),c),e.b=c+=F,e.p=l=K*8,e.f=f;continue}if(l>k){u&&p(0);break}}s&&h(c+131072);for(var Re=(1<<v)-1,$e=(1<<A)-1,j=l;;j=l){var z=y[G(r,l)&Re],D=z>>4;if(l+=z&15,l>k){u&&p(0);break}if(z||p(2),D<256)t[c++]=D;else if(D==256){j=l,y=null;break}else{var le=D-254;if(D>264){var x=D-257,I=ve[x];le=T(r,l,(1<<I)-1)+we[x],l+=I}var _=C[G(r,l)&$e],N=_>>4;_||p(3),l+=_&15;var U=Ve[N];if(N>3){var I=me[N];U+=G(r,l)&(1<<I)-1,l+=I}if(l>k){u&&p(0);break}s&&h(c+131072);var ce=c+le;if(c<U){var he=a-U,ke=Math.min(U,ce);for(he+c<0&&p(3);c<ke;++c)t[c]=n[he+c]}for(;c<ce;++c)t[c]=t[c-U]}}e.l=y,e.p=j,e.b=c,e.f=f,y&&(f=1,e.m=v,e.d=C,e.n=A)}while(!f);return c!=t.length&&o?Je(t,0,c):t.subarray(0,c)},qe=new w(0),Qe=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&p(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},Xe=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Ye=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&p(6,"invalid zlib data"),(r[1]>>5&1)==1&&p(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function et(r,e){return X(r,{i:2},e,e)}function tt(r,e){var t=Qe(r);return t+8>r.length&&p(6,"invalid gzip data"),X(r.subarray(t,-8),{i:2},new w(Xe(r)),e)}function rt(r,e){return X(r.subarray(Ye(r),-4),{i:2},e,e)}function nt(r,e){return r[0]==31&&r[1]==139&&r[2]==8?tt(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?et(r,e):rt(r,e)}var it=typeof TextDecoder<"u"&&new TextDecoder,at=0;try{it.decode(qe,{stream:!0}),at=1}catch{}var ot=Object.defineProperty,st=Math.pow,d=(r,e)=>ot(r,"name",{value:e,configurable:!0}),m=(r,e,t)=>new Promise((n,i)=>{var a=u=>{try{s(t.next(u))}catch(h){i(h)}},o=u=>{try{s(t.throw(u))}catch(h){i(h)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(a,o);s((t=t.apply(r,e)).next())}),vt=d((r,e)=>{let t=!1,n="",i=L.GridLayer.extend({createTile:d((a,o)=>{let s=document.createElement("img"),u=new AbortController,h=u.signal;return s.cancel=()=>{u.abort()},t||(r.getHeader().then(f=>{f.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):f.tileType===2?n="image/png":f.tileType===3?n="image/jpeg":f.tileType===4?n="image/webp":f.tileType===5&&(n="image/avif")}),t=!0),r.getZxy(a.z,a.x,a.y,h).then(f=>{if(f){let l=new Blob([f.data],{type:n}),c=window.URL.createObjectURL(l);s.src=c}else s.style.display="none";s.cancel=void 0,o(void 0,s)}).catch(f=>{if(f.name!=="AbortError")throw f}),s},"createTile"),_removeTile:d(function(a){let o=this._tiles[a];o&&(o.el.cancel&&o.el.cancel(),o.el.width=0,o.el.height=0,o.el.deleted=!0,L.DomUtil.remove(o.el),delete this._tiles[a],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(a)}))},"_removeTile")});return new i(e)},"leafletRasterLayer"),lt=d(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:d(()=>n.abort(),"cancel")}},"v3compat"),be=class{constructor(e){this.tilev4=d((t,n)=>m(this,null,function*(){if(t.type==="json"){let y=t.url.substr(10),C=this.tiles.get(y);if(C||(C=new ge(y),this.tiles.set(y,C)),this.metadata){let A=yield C.getTileJson(t.url);return n.signal.throwIfAborted(),{data:A}}let v=yield C.getHeader();return n.signal.throwIfAborted(),(v.minLon>=v.maxLon||v.minLat>=v.maxLat)&&console.error(`Bounds of PMTiles archive ${v.minLon},${v.minLat},${v.maxLon},${v.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:v.minZoom,maxzoom:v.maxZoom,bounds:[v.minLon,v.minLat,v.maxLon,v.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),a=t.url.match(i);if(!a)throw new Error("Invalid PMTiles protocol URL");let o=a[1],s=this.tiles.get(o);s||(s=new ge(o),this.tiles.set(o,s));let u=a[2],h=a[3],f=a[4],l=yield s.getHeader(),c=yield s==null?void 0:s.getZxy(+u,+h,+f,n.signal);if(n.signal.throwIfAborted(),c)return{data:new Uint8Array(c.data),cacheControl:c.cacheControl,expires:c.expires};if(l.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=lt(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};d(be,"Protocol");var yt=be;function Te(r,e){return(e>>>0)*4294967296+(r>>>0)}d(Te,"toNum");function Ce(r,e){let t=e.buf,n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return Te(r,i);throw new Error("Expected varint not more than 10 bytes")}d(Ce,"readVarintRemainder");function H(r){let e=r.buf,t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,Ce(n,r))}d(H,"readVarint");function Y(r,e,t,n,i){return i===0?n!==0?[r-1-t,r-1-e]:[t,e]:[e,t]}d(Y,"rotate");function Ee(r,e,t){if(r>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>=1<<r||t>=1<<r)throw new Error("tile x/y outside zoom level bounds");let n=((1<<r)*(1<<r)-1)/3,i=r-1,[a,o]=[e,t];for(let s=1<<i;s>0;s>>=1){let u=a&s,h=o&s;n+=(3*u^h)*(1<<i),[a,o]=Y(s,a,o,u,h),i--}return n}d(Ee,"zxyToTileId");function Le(r){let e=3*r+1;return e<4294967296?31-Math.clz32(e):63-Math.clz32(e/4294967296)}d(Le,"tileIdToZ");function ct(r){let e=Le(r)>>1;if(e>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");let t=((1<<e)*(1<<e)-1)/3,n=r-t,i=0,a=0,o=1<<e;for(let s=1;s<o;s<<=1){let u=s&n/2,h=s&(n^u);[i,a]=Y(s,i,a,u,h),n=n/2,i+=u,a+=h}return[e,i,a]}d(ct,"tileIdToZxy");var ht=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(ht||{});function $(r,e){return m(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return nt(new Uint8Array(r));let t=new Response(r).body;if(!t)throw new Error("Failed to read response stream");let n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}d($,"defaultDecompress");var ut=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(ut||{});function Ue(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}d(Ue,"tileTypeExt");var ft=127;function Me(r,e){let t=0,n=r.length-1;for(;t<=n;){let i=n+t>>1,a=e-r[i].tileId;if(a>0)t=i+1;else if(a<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}d(Me,"findTile");var Ae=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return m(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};d(Ae,"FileSource");var wt=Ae,ze=class{constructor(e,t=new Headers){var n,i;this.url=e,this.customHeaders=t,this.mustReload=!1;let a="";"navigator"in globalThis&&(a=(i=(n=globalThis.navigator)==null?void 0:n.userAgent)!=null?i:"");let o=a.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(a);this.chromeWindowsNoCache=!1,o&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,i){return m(this,null,function*(){let a,o;n?o=n:(a=new AbortController,o=a.signal);let s=new Headers(this.customHeaders);s.set("range",`bytes=${e}-${e+t-1}`);let u;this.mustReload?u="reload":this.chromeWindowsNoCache&&(u="no-store");let h=yield fetch(this.url,{signal:o,cache:u,headers:s});if(e===0&&h.status===416){let c=h.headers.get("Content-Range");if(!c||!c.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let y=+c.substr(8);h=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${y-1}`}})}let f=h.headers.get("Etag");if(f!=null&&f.startsWith("W/")&&(f=null),h.status===416||i&&f&&f!==i)throw this.mustReload=!0,new Q(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(h.status>=300)throw new Error(`Bad response code: ${h.status}`);let l=h.headers.get("Content-Length");if(h.status===200&&(!l||+l>t))throw a&&a.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield h.arrayBuffer(),etag:f||void 0,cacheControl:h.headers.get("Cache-Control")||void 0,expires:h.headers.get("Expires")||void 0}})}};d(ze,"FetchSource");var dt=ze;function b(r,e){let t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*st(2,32)+n}d(b,"getUint64");function De(r,e){let t=new DataView(r),n=t.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:b(t,8),rootDirectoryLength:b(t,16),jsonMetadataOffset:b(t,24),jsonMetadataLength:b(t,32),leafDirectoryOffset:b(t,40),leafDirectoryLength:b(t,48),tileDataOffset:b(t,56),tileDataLength:b(t,64),numAddressedTiles:b(t,72),numTileEntries:b(t,80),numTileContents:b(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}d(De,"bytesToHeader");function ee(r){let e={buf:new Uint8Array(r),pos:0},t=H(e),n=[],i=0;for(let a=0;a<t;a++){let o=H(e);n.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let a=0;a<t;a++)n[a].runLength=H(e);for(let a=0;a<t;a++)n[a].length=H(e);for(let a=0;a<t;a++){let o=H(e);o===0&&a>0?n[a].offset=n[a-1].offset+n[a-1].length:n[a].offset=o-1}return n}d(ee,"deserializeIndex");var He=class extends Error{};d(He,"EtagMismatch");var Q=He;function te(r,e){return m(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=t.data.slice(0,ft),i=De(n,t.etag),a=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),o=`${r.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,s=ee(yield e(a,i.internalCompression));return[i,[o,s.length,s]]})}d(te,"getHeaderAndRoot");function re(r,e,t,n,i){return m(this,null,function*(){let a=yield r.getBytes(t,n,void 0,i.etag),o=yield e(a.data,i.internalCompression),s=ee(o);if(s.length===0)throw new Error("Empty directory is invalid");return s})}d(re,"getDirectory");var Pe=class{constructor(e=100,t=!0,n=$){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return m(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,n.data;let i=yield te(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,n,i){return m(this,null,function*(){let a=`${e.getKey()}|${i.etag||""}|${t}|${n}`,o=this.cache.get(a);if(o)return o.lastUsed=this.counter++,o.data;let s=yield re(e,this.decompress,t,n,i);return this.cache.set(a,{lastUsed:this.counter++,data:s}),this.prune(),s})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return m(this,null,function*(){this.cache.delete(e.getKey())})}};d(Pe,"ResolvedValueCache");var Ct=Pe,Ze=class{constructor(e=100,t=!0,n=$){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return m(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;let i=new Promise((a,o)=>{te(e,this.decompress).then(s=>{s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:Promise.resolve(s[1][2])}),a(s[0]),this.prune()}).catch(s=>{o(s)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,n,i){return m(this,null,function*(){let a=`${e.getKey()}|${i.etag||""}|${t}|${n}`,o=this.cache.get(a);if(o)return o.lastUsed=this.counter++,yield o.data;let s=new Promise((u,h)=>{re(e,this.decompress,t,n,i).then(f=>{u(f),this.prune()}).catch(f=>{h(f)})});return this.cache.set(a,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return m(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let n=new Promise((i,a)=>{this.getHeader(e).then(o=>{i(),this.invalidations.delete(t)}).catch(o=>{a(o)})});this.invalidations.set(t,n)})}};d(Ze,"SharedPromiseCache");var gt=Ze,Ie=class{constructor(e,t,n){typeof e=="string"?this.source=new dt(e):this.source=e,n?this.decompress=n:this.decompress=$,t?this.cache=t:this.cache=new gt}getHeader(){return m(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,i){return m(this,null,function*(){let a=Ee(e,t,n),o=yield this.cache.getHeader(this.source);if(e<o.minZoom||e>o.maxZoom)return;let s=o.rootDirectoryOffset,u=o.rootDirectoryLength;for(let h=0;h<=3;h++){let f=yield this.cache.getDirectory(this.source,s,u,o),l=Me(f,a);if(l){if(l.runLength>0){let c=yield this.source.getBytes(o.tileDataOffset+l.offset,l.length,i,o.etag);return{data:yield this.decompress(c.data,o.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}s=o.leafDirectoryOffset+l.offset,u=l.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,n,i){return m(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,i)}catch(a){if(a instanceof Q)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,i);throw a}})}getMetadataAttempt(){return m(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(n))})}getMetadata(){return m(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof Q)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return m(this,null,function*(){let t=yield this.getHeader(),n=yield this.getMetadata(),i=Ue(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};d(Ie,"PMTiles");var ge=Ie;export{ht as Compression,Q as EtagMismatch,dt as FetchSource,wt as FileSource,ge as PMTiles,yt as Protocol,Ct as ResolvedValueCache,gt as SharedPromiseCache,ut as TileType,De as bytesToHeader,Me as findTile,b as getUint64,vt as leafletRasterLayer,H as readVarint,ct as tileIdToZxy,Ue as tileTypeExt,Ee as zxyToTileId};
